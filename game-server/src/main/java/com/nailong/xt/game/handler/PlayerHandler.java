package com.nailong.xt.game.handler;

import com.google.protobuf.ByteString;
import com.nailong.xt.common.annotation.CmdIdHandler;
import com.nailong.xt.common.constants.NetMsgIdConstants;
import com.nailong.xt.common.dao.PlayerDataRepository;
import com.nailong.xt.common.model.po.PlayerData;
import com.nailong.xt.game.player.Player;
import com.nailong.xt.proto.server.Command;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

@Service
@Slf4j
public class PlayerHandler {

    @Autowired
    PlayerDataRepository playerDataRepository;

    @CmdIdHandler(NetMsgIdConstants.player_login_req)
    public void onPlayerLoginReq(Command.CmdReqContext reqContext, Command.CmdReqContext.Builder responseContext, Player player) {
        long accountUid = reqContext.getAccountUid();

        PlayerData createdPlayerData = playerDataRepository.queryOrCreatePlayerDataByAccountId(accountUid);

        log.info("已成功读取 player data {}", createdPlayerData.toString());

        responseContext.setPlayerUid(createdPlayerData.uid());
    }

    @CmdIdHandler(NetMsgIdConstants.player_data_req)
    public void onPlayerDataReq(Command.CmdReqContext reqContext, Command.CmdReqContext.Builder responseContext, Player player) {
        responseContext.setCmdId(NetMsgIdConstants.player_data_succeed_ack);
        responseContext.setProtoData(ByteString.fromHex(
                "d00700f807c1eaf5ca06a00102880209f00700e807010a870678dfb4eaca0608914e20663801400250bd5028001206506c6179657232004a004a004a00720d10ffffffffffffffffff01081d720e10ffffffffffffffffff0108ca01720d10ffffffffffffffffff010819720d10ffffffffffffffffff010804720d10ffffffffffffffffff010832720d10ffffffffffffffffff010831720d10ffffffffffffffffff01080c720d10ffffffffffffffffff01080d720d10ffffffffffffffffff010808720d10ffffffffffffffffff010809720e10ffffffffffffffffff0108e801720e10ffffffffffffffffff0108e501720d10ffffffffffffffffff01086a720d10ffffffffffffffffff01081c720d10ffffffffffffffffff010866720d10ffffffffffffffffff010818720d10ffffffffffffffffff010869720d10ffffffffffffffffff010868720d10ffffffffffffffffff01081a720d10ffffffffffffffffff010810720d10ffffffffffffffffff010811720d10ffffffffffffffffff010812720d10ffffffffffffffffff010817720d10ffffffffffffffffff010814720d10ffffffffffffffffff010816720d10ffffffffffffffffff010815720d10ffffffffffffffffff010865720d10ffffffffffffffffff010833720d10ffffffffffffffffff010802720d10ffffffffffffffffff010806720d10ffffffffffffffffff01081b720d10ffffffffffffffffff010830720d10ffffffffffffffffff01082f720d10ffffffffffffffffff01080f720d10ffffffffffffffffff01080e720e10ffffffffffffffffff0108c901720d10ffffffffffffffffff01080b720d10ffffffffffffffffff01080a720d10ffffffffffffffffff010820720d10ffffffffffffffffff010803720d10ffffffffffffffffff010807720d10ffffffffffffffffff01082e720d10ffffffffffffffffff010805720d10ffffffffffffffffff01082d720d10ffffffffffffffffff01082c720d10ffffffffffffffffff01082a720d10ffffffffffffffffff010829720d10ffffffffffffffffff01082b720d10ffffffffffffffffff0108012a003a0f0a0d20dfb4eaca06280108f00118014204100008014a006ae1010a0d08ea07100020027a04080010010a0d08eb07100020027a04080010050a0d08e907100120027a04080110010a0d08ee07100020027a04080010010a0d08ef07100020027a04080010010a0d08ec07100020027a04080010640a0d08ed07100020027a04080010010a0d08f207100020027a04080010010a0d08d20f100020027a04080010010a0d08d30f100020027a04080010010a0d08f007100020027a04080010010a0d08d10f100020027a04080010010a0d08f107100020027a04080010010a0d08d40f100020027a04080010010a0d08d50f100020027a040800100172361800b001010a020801220208012a0a0a0800000000000000003a02080052007a02080082010208038a010208049201009a0100a20100ca01020803f20100fa01a60112000a060867100020010a060865100020010a0708ca01100020010a06086b100020010a0708cc01100020010a0708b102100020010a0708b002100020010a0708ae02100020010a0708c901100020010a0708cb01100020010a0708cf01100020010a060866100020010a0708cd01100020010a0708af02100020010a0708ad02100020010a06086a100020010a060869100020010a060868100020010a0708ce01100020019201400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000050ce01506750ca01506b50cc0150910350b20250b10250b00250ae0250cb0150cf015066506c50b40250cd0150b30250d001506a5069506850af028001bd851912041003081c1a06180210b3ea011a06180110d3860322a901f807e0b4eaca060867480160bd506800700078008a0100ba016b0800122110ffffffffffffffffff0110ffffffffffffffffff0110ffffffffffffffffff01122110ffffffffffffffffff0110ffffffffffffffffff0110ffffffffffffffffff01122110ffffffffffffffffff0110ffffffffffffffffff0110ffffffffffffffffff019a0108000000000000000050015001500150015001b201020801b201020802b20102080322a901f807e0b4eaca060871480160a5586800700078008a0100ba016b0800122110ffffffffffffffffff0110ffffffffffffffffff0110ffffffffffffffffff01122110ffffffffffffffffff0110ffffffffffffffffff0110ffffffffffffffffff01122110ffffffffffffffffff0110ffffffffffffffffff0110ffffffffffffffffff019a0108000000000000000050015001500150015001b201020801b201020802b20102080322a901f807e0b4eaca060870480160c1576800700078008a0100ba016b0800122110ffffffffffffffffff0110ffffffffffffffffff0110ffffffffffffffffff01122110ffffffffffffffffff0110ffffffffffffffffff0110ffffffffffffffffff01122110ffffffffffffffffff0110ffffffffffffffffff0110ffffffffffffffffff019a0108000000000000000050015001500150015001b201020801b201020802b201020803620708f9e9ee021001620708fbe9ee021001620708f5e9ee021001620708e3f1ee0210016207088fe2ee021001620708e1f1ee021001620708dff1ee0210016207088de2ee021001620708def1ee021001620708ddf1ee02100162070894e2ee02100162070891e2ee02100162070890e2ee02100162070893e2ee021001620708fae9ee02100162070892e2ee021001620708f8e9ee021001620708f6e9ee021001620708e4f1ee021001620708e2f1ee021001620708e0f1ee0210016207088ee2ee021001620708fce9ee021001620708f7e9ee0210019a010c0801120800000000000120019a010c0802120800000000000000009a010c080312080000000000000000aa01020802aa01020801b2010508ec071001b2010508e8071001b2010508ea071001b2010508ed071001b2010508e9071001b2010508eb071001ba013e08021204080110021204080210021204080310021204080410021204080510021204080610021204080710021204080810021204080910021204080a1002ba01260801120408011002120408021002120408031002120408041002120408051002120408061002ba012c0803120408011002120408021002120408031002120408041002120408051002120408061002120408071002c2010c100118ffffffff0708f19c06e2011678e0b4eaca0608bdf00c100118002000280030003800e2011678e0b4eaca0608bff00c100118002000280030003800e2011678e0b4eaca0608b9f00c100118002000280030003800e2011678e0b4eaca0608c0f00c10011800200028003000380092020508ec07100192020508bd17100192020508e807100192020508d30f100192020508d20f100192020508ea07100192020508d10f100192020508d00f100192020508d50f100192020508d40f100192020508ed07100192020508e907100192020508eb07100192020508bc17100192020508bb17100192020508ba17100192020508b817100192020508b91710019a0207088fbefa0220009a020708c6d5fa0220009a0207088dbefa0220009a020708decdfa0220009a02070896e5fa0220009a02070895e5fa0220009a02070897e5fa0220009a020708ddcdfa0220009a020708c5d5fa0220009a0207088ebefa0220009a020708c7d5fa0220009a020708dfcdfa0220009a020708afddfa0220009a020708f7c5fa0220009a020708adddfa0220009a020708f6c5fa0220009a020708f5c5fa0220009a020708aeddfa022000a2020508e8071001a2020508d20f1001a2020508ea071001a2020508d10f1001a2020508d00f1001a2020508e9071001a2020508ba171001a2020508b8171001a2020508b9171001e20700e20700e20700"
        ));
    }
}
